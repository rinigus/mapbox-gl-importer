layers:
  - id: aerodrome_label
    table: |
      SELECT geometry,
      name,
      COALESCE(NULLIF(name_en, ''), name) AS name_en,
      CASE
        WHEN aerodrome = 'international'
            OR aerodrome_type = 'international'
          THEN 'international'
        WHEN
            aerodrome = 'public'
            OR aerodrome_type LIKE '%public%'
            OR aerodrome_type = 'civil'
          THEN 'public'
        WHEN
            aerodrome = 'regional'
            OR aerodrome_type = 'regional'
          THEN 'regional'
        WHEN
            aerodrome = 'military'
            OR aerodrome_type LIKE '%military%'
            OR military = 'airfield'
          THEN 'military'
        WHEN
            aerodrome = 'private'
            OR aerodrome_type = 'private'
          THEN 'private'
        ELSE 'other'
      END AS class,
      NULLIF(iata, '') AS iata,
      NULLIF(icao, '') AS icao,
      substring(ele from E'^(-?\\d+)(\\D|$)')::int AS ele,
      round(substring(ele from E'^(-?\\d+)(\\D|$)')::int*3.2808399)::int AS ele_ft
      FROM osm_aerodrome_label_point
      WHERE geometry && !bbox!
      {% if z <= 11 %}
      AND iata<>''
      {% endif %}
    zmin: 6

schema:
  - update.sql
